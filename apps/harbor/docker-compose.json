{
  "schemaVersion": 2,
  "services": [
    {
      "name": "harbor-core",
      "image": "goharbor/harbor-core:v2.12.0",
      "container_name": "harbor-core",
      "isMain": true,
      "depends_on": ["harbor-db", "harbor-redis"],
      "environment": [
        {"key": "CORE_SECRET", "value": "not-a-secure-secret"},
        {"key": "JOBSERVICE_SECRET", "value": "not-a-secure-secret"},
        {"key": "POSTGRESQL_HOST", "value": "harbor-db"},
        {"key": "POSTGRESQL_PORT", "value": "5432"},
        {"key": "POSTGRESQL_DATABASE", "value": "registry"},
        {"key": "POSTGRESQL_USERNAME", "value": "postgres"},
        {"key": "POSTGRESQL_PASSWORD", "value": "${POSTGRES_PASSWORD}"},
        {"key": "REGISTRY_CONTROLLER_URL", "value": "http://harbor-registry:8080"},
        {"key": "PORTAL_URL", "value": "http://harbor-portal:8080"},
        {"key": "REDIS_HOST", "value": "harbor-redis:6379"},
        {"key": "HARBOR_ADMIN_PASSWORD", "value": "${HARBOR_ADMIN_PASSWORD}"},
        {"key": "NO_PROXY", "value": "harbor-core,harbor-db,harbor-redis,harbor-registry,harbor-portal"}
      ],
      "volumes": [
        {
          "type": "bind",
          "hostPath": "${APP_DATA_DIR}/data/config",
          "containerPath": "/etc/core"
        },
        {
          "type": "bind",
          "hostPath": "${APP_DATA_DIR}/data/ca_download",
          "containerPath": "/etc/core/ca"
        }
      ],
      "ports": [
        {
          "containerPort": 8080,
          "hostPort": 8888
        }
      ]
    },
    {
      "name": "harbor-db",
      "image": "goharbor/harbor-db:v2.12.0",
      "container_name": "harbor-db",
      "environment": [
        {"key": "POSTGRES_PASSWORD", "value": "${POSTGRES_PASSWORD}"},
        {"key": "POSTGRES_USER", "value": "postgres"},
        {"key": "POSTGRES_DB", "value": "registry"}
      ],
      "volumes": [
        {
          "type": "bind",
          "hostPath": "${APP_DATA_DIR}/data/database",
          "containerPath": "/var/lib/postgresql/data"
        }
      ]
    },
    {
      "name": "harbor-redis",
      "image": "goharbor/redis-photon:v2.12.0",
      "container_name": "harbor-redis",
      "volumes": [
        {
          "type": "bind",
          "hostPath": "${APP_DATA_DIR}/data/redis",
          "containerPath": "/var/lib/redis"
        }
      ]
    },
    {
      "name": "harbor-registry",
      "image": "goharbor/registry-photon:v2.12.0",
      "container_name": "harbor-registry",
      "depends_on": ["harbor-redis"],
      "environment": [
        {"key": "REGISTRY_REDIS_ADDR", "value": "harbor-redis:6379"}
      ],
      "volumes": [
        {
          "type": "bind",
          "hostPath": "${APP_DATA_DIR}/data/registry",
          "containerPath": "/storage"
        }
      ]
    },
    {
      "name": "harbor-portal",
      "image": "goharbor/harbor-portal:v2.12.0",
      "container_name": "harbor-portal",
      "depends_on": ["harbor-core"]
    }
  ]
}
